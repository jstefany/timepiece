<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Clock tutorial v2 - station</title>
        <link rel="stylesheet" href="css/clock.css">
    </head>
    
    <body>
        <div class="prototype-wrapper"> <!-- A wrapper to emulate use in a webpage and center align -->

            <div id="main">
                <h1>Morning Edition</h1>
                <p>July 2013</p>
                
                <div id="chart">
                    <div id="explanation" style="visibility: hidden;">
                        <span id="segmentName"></span><br/>
                        <span id="segmentStart"></span><br/>
                        <span id="segmentLength"></span><br/>
                    </div>
                </div>
            </div>
            
            <div id="marker">
                <div id="marker0">0</div>
                <div id="marker15">15</div>
                <div id="marker30">30<br/><a href="me_tutorial.html">Next</a></div>
                <div id="marker45">45</div>
            </div>
        
        </div>

            
        <script src="http://d3js.org/d3.v3.min.js"></script>
        <script>
            
            var width = 960,
            height = 700,
            radius = Math.min(width, height) / 2.5;
            
            // Mapping of segment types to colors.
            var colors = {
                "Promo": "#9e9ac8",
                "Newscast": "#e7ba52",
                "Credit": "#a1d99b",
                "Music": "#c7c7c7",
                "Segment": "#9ecae1",
                "Fill segment": "#c6dbef",
                "Other": "#dadaeb"
            };
            
            var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("id", "container")
            .attr("transform", "translate(" + width / 2 + "," + height * .52 + ")");
            
            var partition = d3.layout.partition()
            .sort(null)
            .size([2 * Math.PI, radius * radius])
            .value(function(d) { return d.size; });
            
            var arc = d3.svg.arc()
            .startAngle(function(d) { return d.x; })
            .endAngle(function(d) { return d.x + d.dx; })
            .innerRadius(function(d) { return Math.sqrt(d.y); })
            .outerRadius(function(d) { return Math.sqrt(d.y + d.dy); });
            
            var dataFile = "me_baseline_station.json";
            
            d3.json(dataFile, function(error, root) {
                    var path = svg.datum(root).selectAll("path")
                    .data(partition.nodes)
                    .enter().append("path")
                    .attr("display", function(d) { return d.depth ? null : "none"; }) // hide inner ring
                    .attr("d", arc)
                    .style("stroke", "#fff")
                    .style("fill", function(d) { return colors[d.type]; })
                    .on("mouseover", mouseover)
                    });
            
            // Add the mouseleave handler to the bounding circle.
            d3.select("#container").on("mouseleave", mouseleave);
            
            
            // Show explanation panel when hovering over a segment.
            function mouseover(d) {
                
                d3.select("#segmentName")
                .text(d.name);
                
                d3.select("#segmentStart")
                .text("Start: " + d.startTime);
                
                d3.select("#segmentLength")
                .text("Length: " + Math.floor(d.size) + ":" + (Math.round((d.size - Math.floor(d.size))*60) + "0").substr(0,2));
                
                d3.select("#explanation")
                .style("visibility", "");
            }
            
            // Hide explanation panel when moving off of a segment.
            function mouseleave(d) {
                
                d3.select("#explanation")
                .style("visibility", "hidden");
            }
            
            d3.select(self.frameElement).style("height", height + "px");
            
        </script>
    </body>
</html>
